<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Anime Stream{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
        }
        .anime-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <nav class="gradient-bg shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('index') }}" class="text-white text-xl font-bold">
                        <i class="fas fa-play-circle mr-2"></i>
                        AnimeStream
                    </a>
                </div>
                
                <div class="flex-1 max-w-lg mx-8">
                    <form action="{{ url_for('search') }}" method="GET" class="relative">
                        <input type="text" 
                               name="name" 
                               placeholder="Cari anime..." 
                               class="w-full px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/30"
                               value="{{ request.args.get('name', '') }}">
                        <button type="submit" class="absolute right-3 top-2.5 text-white/70 hover:text-white">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
                
                <!-- Mobile Menu Button -->
                <!-- <div class="md:hidden">
                    <button class="text-white hover:text-gray-300">
                        <i class="fas fa-bars"></i>
                    </button>
                </div> -->
            </div>
        </div>
    </nav>

    <main class="min-h-screen">
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-gray-400">
                    &copy; {{ current_year }} AnimeStream. Made with ❤️
                </p>
                <p class="text-gray-400">
                    Credit @waaann.a
                </p>
            </div>
        </div>
    </footer>

    <div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden pointer-events-none">
        <div class="bg-white rounded-lg p-6 text-center pointer-events-auto">
            <div class="loading w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-700">Loading...</p>
        </div>
    </div>

    <script>
        function showLoading() {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.remove('hidden');
            overlay.classList.remove('pointer-events-none');
        }

        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.add('hidden');
            overlay.classList.add('pointer-events-none');
        }

        // Hide loading overlay when page loads
        window.addEventListener('load', hideLoading);

        // Hide loading overlay when page becomes visible (for back button)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                hideLoading();
            }
        });

        // Hide loading overlay when page shows (for back/forward navigation)
        window.addEventListener('pageshow', function(event) {
            hideLoading();
        });

        // Hide loading overlay when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            hideLoading();
        });

        // Hide loading overlay when browser back/forward button is used
        window.addEventListener('popstate', function(event) {
            hideLoading();
        });

        // Show loading for forms
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', showLoading);
        });

        // Show loading for anime and watch links, but not for back buttons
        document.querySelectorAll('a[href*="/anime/"], a[href*="/watch/"]').forEach(link => {
            // Don't add loading to buttons that use history.back()
            if (!link.hasAttribute('onclick') || !link.getAttribute('onclick').includes('history.back')) {
                link.addEventListener('click', showLoading);
            }
        });

        // Global back function to hide loading
        window.goBack = function() {
            hideLoading();
            history.back();
        };

        // Auto-hide loading after 5 seconds as fallback
        setTimeout(hideLoading, 5000);

        // Hide loading immediately when script runs
        hideLoading();
    </script>
</body>
</html>
