{% extends "base.html" %}

{% block title %}{% if keyword %}Hasil Pencarian {{ keyword }}{% else %}Cari Anime{% endif %} - AnimeStream{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-8">
        {% if keyword %}
        <h1 class="text-3xl font-bold mb-4">
            <i class="fas fa-search mr-2"></i>
            Hasil Pencarian: "{{ keyword }}"
        </h1>
        {% else %}
        <h1 class="text-3xl font-bold mb-4">
            <i class="fas fa-search mr-2"></i>
            Cari Anime
        </h1>
        {% endif %}
    </div>

    {% if results %}
        {% if results %}
        <div class="mb-4">
            <p class="text-gray-400">Ditemukan {{ results|length }} hasil</p>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% for anime in results %}
            <div class="anime-card rounded-lg overflow-hidden card-hover">
                <a href="{{ url_for('anime_detail', anime_url=anime.get('url', '')) }}" class="block">
                    <div class="aspect-[3/4] bg-gray-800 relative overflow-hidden">
                        {% if anime.get('cover_url') %}
                        <img src="{{ anime['cover_url'] }}" 
                                alt="{{ anime.get('title', 'Anime') }}"
                                class="w-full h-full object-cover"
                                loading="lazy">
                        {% else %}
                        <div class="w-full h-full flex items-center justify-center">
                            <i class="fas fa-image text-4xl text-gray-600"></i>
                        </div>
                        {% endif %}
                        
                        <div class="absolute inset-0 bg-black/50 opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <i class="fas fa-play-circle text-4xl text-white"></i>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="font-semibold text-sm line-clamp-2 mb-2">
                            {{ anime.get('title', 'Untitled') }}
                        </h3>
                        
                        <div class="text-xs text-gray-400 space-y-1">
                            {% if anime.get('status') %}
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-circle mr-2 {% if anime['status'].lower() == 'ongoing' %}text-green-500{% elif anime['status'].lower() == 'completed' %}text-blue-500{% else %}text-gray-500{% endif %}"></i>
                                    <span class="{% if anime['status'].lower() == 'ongoing' %}status-ongoing{% elif anime['status'].lower() == 'completed' %}status-completed{% endif %}">{{ anime['status'] }}</span>
                                </div>
                                {% if anime.get('rating') %}
                                <div class="flex items-center">
                                    <i class="fas fa-star mr-1 {% if anime['rating']|float >= 8 %}rating-high{% elif anime['rating']|float >= 6 %}rating-medium{% else %}rating-low{% endif %}"></i>
                                    <span class="{% if anime['rating']|float >= 8 %}rating-high{% elif anime['rating']|float >= 6 %}rating-medium{% else %}rating-low{% endif %}">{{ anime['rating'] }}</span>
                                </div>
                                {% endif %}
                            </div>
                            {% elif anime.get('rating') %}
                            <div class="flex items-center">
                                <i class="fas fa-star mr-2 {% if anime['rating']|float >= 8 %}rating-high{% elif anime['rating']|float >= 6 %}rating-medium{% else %}rating-low{% endif %}"></i>
                                <span class="{% if anime['rating']|float >= 8 %}rating-high{% elif anime['rating']|float >= 6 %}rating-medium{% else %}rating-low{% endif %}">{{ anime['rating'] }}</span>
                            </div>
                            {% endif %}
                            
                            {% if anime.get('genres') %}
                            <div class="mt-2">
                                <div class="flex flex-wrap gap-1">
                                    {% for genre in anime['genres'][:2] %}
                                    <span class="info-badge">{{ genre['name'] }}</span>
                                    {% endfor %}
                                    {% if anime['genres']|length > 2 %}
                                    <span class="info-badge">+{{ anime['genres']|length - 2 }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        
        {% elif 'error' in results %}
        <div class="text-center py-16">
            <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
            <h3 class="text-2xl font-bold mb-2">Terjadi Kesalahan</h3>
            <p class="text-gray-400 mb-4">{{ results['error'] }}</p>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-semibold transition-colors">
                <i class="fas fa-refresh mr-2"></i>
                Coba Lagi
            </button>
        </div>
        
        {% else %}
        <div class="text-center py-16">
            <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
            <h3 class="text-2xl font-bold mb-2">Tidak ditemukan hasil</h3>
            <p class="text-gray-400 mb-4">Coba gunakan kata kunci yang berbeda</p>
        </div>
        {% endif %}
        
    {% elif keyword %}
    <div class="text-center py-16">
        <div class="loading w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
        <p class="text-gray-400">Mencari anime...</p>
    </div>
    
    {% else %}
    <div class="text-center py-16">
        <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
        <h3 class="text-2xl font-bold mb-2">Cari Anime Favorit Anda</h3>
        <p class="text-gray-400 mb-8">Gunakan form pencarian di atas untuk menemukan anime yang ingin ditonton</p>
        
        <div class="max-w-2xl mx-auto">
            <h4 class="text-lg font-semibold mb-4">Pencarian Populer:</h4>
            <div class="flex flex-wrap gap-2 justify-center">
                <a href="{{ url_for('search', name='Naruto') }}" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors">
                    Naruto
                </a>
                <a href="{{ url_for('search', name='Attack on Titan') }}" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors">
                    Attack on Titan
                </a>
                <a href="{{ url_for('search', name='One Piece') }}" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors">
                    One Piece
                </a>
                <a href="{{ url_for('search', name='Demon Slayer') }}" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors">
                    Demon Slayer
                </a>
                <a href="{{ url_for('search', name='My Hero Academia') }}" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors">
                    My Hero Academia
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.anime-card {
    transition: all 0.3s ease;
}

.anime-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.anime-card .info-badge {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 0.75rem;
    color: #93c5fd;
}

.anime-card .status-ongoing {
    color: #10b981;
}

.anime-card .status-completed {
    color: #3b82f6;
}

.anime-card .rating-high {
    color: #fbbf24;
}

.anime-card .rating-medium {
    color: #f59e0b;
}

.anime-card .rating-low {
    color: #9ca3af;
}

@media (max-width: 640px) {
    .anime-card .p-4 {
        padding: 12px;
    }
    
    .anime-card h3 {
        font-size: 0.8rem;
        line-height: 1.2;
    }
    
    .anime-card .text-xs {
        font-size: 0.7rem;
    }
    
    .anime-card .space-y-1 > * + * {
        margin-top: 2px;
    }
}
</style>
{% endblock %}
